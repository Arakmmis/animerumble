"use strict";

Vue.use(VTooltip);
var app = new Vue({
  el: "#app",
  data: {
    mode: "game",
    log: [],
    current: 0,
    source: {
      energy: {
        ally: {}
      },
      meta: {}
    },
    state: {
      description: null
    },
    packet: [],
    action: []
  },
  methods: {
    next: function next() {
      var goTo = this.current + 1;

      if (goTo >= this.log.length) {
        goTo = this.log.length - 1;
      }

      this.current = goTo;
      vueBind(app.log[goTo]);
    },
    previous: function previous() {
      var goTo = this.current - 1;

      if (goTo < 0) {
        goTo = 0;
      }

      this.current = goTo;
      vueBind(app.log[goTo]);
    },
    onDescription: function onDescription(payload) {
      var option = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : undefined;

      if (option === undefined) {
        option = "ally";
      } //Sound
      // this.$refs.soundClick.play();
      //Define


      var owner = this.source[option][payload.heroIndex];
      var skillIndex = owner.skill.findIndex(function (x) {
        return x.id === payload.skillId;
      });
      var config = {
        nameId: payload.nameId,
        skill: skillIndex,
        skillId: payload.skillId,
        heroIndex: payload.heroIndex,
        option: option
      };
      var skill = owner.skill[config.skill]; //Map Description

      var map = {
        name: skill.name,
        energy: {
          a: skill.energy.a,
          i: skill.energy.i,
          s: skill.energy.s,
          w: skill.energy.w,
          r: skill.energy.r,
          total: skill.energy.a + skill.energy.i + skill.energy.s + skill.energy.w + skill.energy.r
        },
        description: skill.description,
        classes: skill.classes,
        cooldown: skill.cooldown
      };
      var alt = skill.alt !== false ? skill.alt : false; //Buffer Description

      var state = this.state;
      state.description = {
        nameId: config.nameId,
        skill: config.skillId,
        heroIndex: config.heroIndex,
        map: map,
        alt: alt,
        option: option
      };
    },
    onGetImage: function onGetImage(payload, option) {
      if (option === "packet") {
        console.log("hi");
        var index = this.source.ally.findIndex(function (x) {
          return x.name === payload.offense;
        });
        var nameId = this.source.ally[index].nameId;
        return "/assets/character/" + nameId.slice(0, -1) + "/skill" + (payload.skill + 1) + "/avatar.jpg";
      } else if (option === "char") {
        return "/assets/character/" + payload.nameId.slice(0, -1) + "/avatar.jpg";
      } else if (option === "skill") {
        return "/assets/character/" + payload.nameId.slice(0, -1) + "/skill" + (payload.skill + 1) + "/avatar.jpg";
      } else if (option === "status") {
        return "/assets/character/" + payload.nameId.slice(0, -1) + "/skill" + payload.skill + "/avatar.jpg";
      }
    },
    onHP: function onHP(hp) {
      if (hp > 70) {
        return "l--hp-full";
      } else if (hp <= 70 && hp >= 40) {
        return "l--hp-mid";
      } else {
        return "l--hp-low";
      }
    },
    targetingCue: function targetingCue(payload, nameId) {
      var name = payload;
      var index = this.packet.findIndex(function (x) {
        return x.offense === payload;
      });
      var packet = this.packet[index];
      var result = {
        name: name,
        skillIndex: packet.skill,
        skillId: packet.skillId,
        heroIndex: packet.heroIndex,
        target: packet.target
      };

      if (nameId) {
        result.nameId = nameId;
      }

      console.log(result);
      return result;
    }
  }
});
"use strict";

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function vueBind(payload) {
  console.log(payload);
  var ally = "teamEven";
  var enemy = "teamOdd";
  var turnVal = ally === "teamEven" ? 0 : 1;
  var myTurn = payload.turn % 2 === turnVal ? true : false; //Time

  var timeDiff = (Date.now() - payload.timestamp) / 1000;
  var timeCalc = Math.floor(45 - timeDiff);
  var remaining = 100 * (timeCalc / 45);
  console.log(payload.timestamp, timeDiff, timeCalc, remaining);
  var store = {
    energy: {
      ally: payload.energy[ally],
      enemy: payload.energy[enemy]
    },
    ally: payload[ally].map(function (x) {
      return _objectSpread({}, x, {
        skill: app.mode === "game" ? x.skill : x.skill.sort(function (a, b) {
          return a.id - b.id;
        }),
        indicator: statusView(x.name, x.status, turnVal)
      });
    }),
    enemy: payload[enemy].map(function (x) {
      return _objectSpread({}, x, {
        skill: x.skill.sort(function (a, b) {
          return a.id - b.id;
        }),
        indicator: statusView(x.name, x.status, turnVal)
      });
    }),
    turn: payload.turn,
    myTurn: myTurn,
    turnVal: turnVal,
    room: payload.room,
    meta: {
      myName: payload.team[ally],
      theirName: payload.team[enemy]
    },
    timestamp: payload.timestamp
  };
  store.energy.ally.r = store.energy.ally.a + store.energy.ally.i + store.energy.ally.s + store.energy.ally.w;
  app.source = store;
  app.packet = payload.log;
  app.action.push(payload.log); // app.state.button = button;
  // app.state.winner = payload.winner;
  // app.state.exchange.modal = false;
}

function statusView(name, payload, turnVal) {
  console.log(name.slice(-1), payload);

  var status = _.concat(payload.onAttack, payload.onReceive, payload.onState, payload.onSelf);

  console.log("invisible", turnVal, name.slice(-1)); // status = status.filter(
  //   x =>
  //     x.isInvisible === false ||
  //     (x.isInvisible !== false && Number(x.nameId.slice(-1)) === turnVal)
  // );

  var groupByNameId = _.groupBy(status, "nameId");

  var valuesByNameId = _.values(groupByNameId);

  var groupBySkillIndex = valuesByNameId.map(function (x) {
    return _.groupBy(x, "skillIndex");
  });

  var valuesBySkillIndex = _.values(groupBySkillIndex);

  var concatValues = [];
  valuesBySkillIndex.forEach(function (x) {
    concatValues = concatValues.concat(_.values(x));
  });
  var final = concatValues.map(function (x) {
    var info = x[0];
    return {
      name: info.name,
      nameId: info.nameId,
      skillIndex: info.skillIndex,
      active: info.active,
      val: x
    };
  });
  return final;
} // vueBind(app.log[0]);
"use strict";

function getParameterName(name, url) {
  if (!url) url = window.location.href;
  name = name.replace(/[\[\]]/g, "\\$&");
  var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
      results = regex.exec(url);
  if (!results) return null;
  if (!results[2]) return "";
  return decodeURIComponent(results[2].replace(/\+/g, " "));
}

var url = window.location.href.split("/");
var room = url[url.length - 1];
app.$http.get("/replay/history/" + room).then(function (response) {
  console.log(response);

  if (response.status == "200") {
    var body = response.body[0];
    app.log = body.log;
    vueBind(body.log[0]);
  }
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZ1ZS5qcyIsInJlbmRlcmVyLmpzIiwiZ2VuZXJhbC5qcyJdLCJuYW1lcyI6WyJWdWUiLCJ1c2UiLCJWVG9vbHRpcCIsImFwcCIsImVsIiwiZGF0YSIsIm1vZGUiLCJsb2ciLCJjdXJyZW50Iiwic291cmNlIiwiZW5lcmd5IiwiYWxseSIsIm1ldGEiLCJzdGF0ZSIsImRlc2NyaXB0aW9uIiwicGFja2V0IiwiYWN0aW9uIiwibWV0aG9kcyIsIm5leHQiLCJnb1RvIiwibGVuZ3RoIiwidnVlQmluZCIsInByZXZpb3VzIiwib25EZXNjcmlwdGlvbiIsInBheWxvYWQiLCJvcHRpb24iLCJ1bmRlZmluZWQiLCJvd25lciIsImhlcm9JbmRleCIsInNraWxsSW5kZXgiLCJza2lsbCIsImZpbmRJbmRleCIsIngiLCJpZCIsInNraWxsSWQiLCJjb25maWciLCJuYW1lSWQiLCJtYXAiLCJuYW1lIiwiYSIsImkiLCJzIiwidyIsInIiLCJ0b3RhbCIsImNsYXNzZXMiLCJjb29sZG93biIsImFsdCIsIm9uR2V0SW1hZ2UiLCJjb25zb2xlIiwiaW5kZXgiLCJvZmZlbnNlIiwic2xpY2UiLCJvbkhQIiwiaHAiLCJ0YXJnZXRpbmdDdWUiLCJyZXN1bHQiLCJ0YXJnZXQiLCJlbmVteSIsInR1cm5WYWwiLCJteVR1cm4iLCJ0dXJuIiwidGltZURpZmYiLCJEYXRlIiwibm93IiwidGltZXN0YW1wIiwidGltZUNhbGMiLCJNYXRoIiwiZmxvb3IiLCJyZW1haW5pbmciLCJzdG9yZSIsInNvcnQiLCJiIiwiaW5kaWNhdG9yIiwic3RhdHVzVmlldyIsInN0YXR1cyIsInJvb20iLCJteU5hbWUiLCJ0ZWFtIiwidGhlaXJOYW1lIiwicHVzaCIsIl8iLCJjb25jYXQiLCJvbkF0dGFjayIsIm9uUmVjZWl2ZSIsIm9uU3RhdGUiLCJvblNlbGYiLCJncm91cEJ5TmFtZUlkIiwiZ3JvdXBCeSIsInZhbHVlc0J5TmFtZUlkIiwidmFsdWVzIiwiZ3JvdXBCeVNraWxsSW5kZXgiLCJ2YWx1ZXNCeVNraWxsSW5kZXgiLCJjb25jYXRWYWx1ZXMiLCJmb3JFYWNoIiwiZmluYWwiLCJpbmZvIiwiYWN0aXZlIiwidmFsIiwiZ2V0UGFyYW1ldGVyTmFtZSIsInVybCIsIndpbmRvdyIsImxvY2F0aW9uIiwiaHJlZiIsInJlcGxhY2UiLCJyZWdleCIsIlJlZ0V4cCIsInJlc3VsdHMiLCJleGVjIiwiZGVjb2RlVVJJQ29tcG9uZW50Iiwic3BsaXQiLCIkaHR0cCIsImdldCIsInRoZW4iLCJyZXNwb25zZSIsImJvZHkiXSwibWFwcGluZ3MiOiI7O0FBQUFBLElBQUlDLEdBQUosQ0FBUUMsUUFBUjtBQUNBLElBQUlDLE1BQU0sSUFBSUgsR0FBSixDQUFRO0FBQ2hCSSxNQUFJLE1BRFk7QUFFaEJDLFFBQU07QUFDSkMsVUFBTSxNQURGO0FBRUpDLFNBQUssRUFGRDtBQUdKQyxhQUFTLENBSEw7QUFJSkMsWUFBUTtBQUNOQyxjQUFRO0FBQ05DLGNBQU07QUFEQSxPQURGO0FBSU5DLFlBQU07QUFKQSxLQUpKO0FBVUpDLFdBQU87QUFDTEMsbUJBQWE7QUFEUixLQVZIO0FBYUpDLFlBQVEsRUFiSjtBQWNKQyxZQUFRO0FBZEosR0FGVTtBQWtCaEJDLFdBQVM7QUFDUEMsUUFETyxrQkFDQTtBQUNMLFVBQUlDLE9BQU8sS0FBS1gsT0FBTCxHQUFlLENBQTFCOztBQUNBLFVBQUlXLFFBQVEsS0FBS1osR0FBTCxDQUFTYSxNQUFyQixFQUE2QjtBQUMzQkQsZUFBTyxLQUFLWixHQUFMLENBQVNhLE1BQVQsR0FBa0IsQ0FBekI7QUFDRDs7QUFDRCxXQUFLWixPQUFMLEdBQWVXLElBQWY7QUFDQUUsY0FBUWxCLElBQUlJLEdBQUosQ0FBUVksSUFBUixDQUFSO0FBQ0QsS0FSTTtBQVNQRyxZQVRPLHNCQVNJO0FBQ1QsVUFBSUgsT0FBTyxLQUFLWCxPQUFMLEdBQWUsQ0FBMUI7O0FBQ0EsVUFBSVcsT0FBTyxDQUFYLEVBQWM7QUFDWkEsZUFBTyxDQUFQO0FBQ0Q7O0FBQ0QsV0FBS1gsT0FBTCxHQUFlVyxJQUFmO0FBQ0FFLGNBQVFs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akUsVUFBUTFDLEdBQVIsQ0FBWTJHLFFBQVo7O0FBQ0EsTUFBSUEsU0FBU3ZDLE1BQVQsSUFBbUIsS0FBdkIsRUFBOEI7QUFDNUIsUUFBSXdDLE9BQU9ELFNBQVNDLElBQVQsQ0FBYyxDQUFkLENBQVg7QUFDQWhILFFBQUlJLEdBQUosR0FBVTRHLEtBQUs1RyxHQUFmO0FBQ0FjLFlBQVE4RixLQUFLNUcsR0FBTCxDQUFTLENBQVQsQ0FBUjtBQUNEO0FBQ0YsQ0FQRCIsImZpbGUiOiJyZXBsYXkubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiVnVlLnVzZShWVG9vbHRpcCk7XG5sZXQgYXBwID0gbmV3IFZ1ZSh7XG4gIGVsOiBcIiNhcHBcIixcbiAgZGF0YToge1xuICAgIG1vZGU6IFwiZ2FtZVwiLFxuICAgIGxvZzogW10sXG4gICAgY3VycmVudDogMCxcbiAgICBzb3VyY2U6IHtcbiAgICAgIGVuZXJneToge1xuICAgICAgICBhbGx5OiB7fVxuICAgICAgfSxcbiAgICAgIG1ldGE6IHt9XG4gICAgfSxcbiAgICBzdGF0ZToge1xuICAgICAgZGVzY3JpcHRpb246IG51bGxcbiAgICB9LFxuICAgIHBhY2tldDogW10sXG4gICAgYWN0aW9uOiBbXVxuICB9LFxuICBtZXRob2RzOiB7XG4gICAgbmV4dCgpIHtcbiAgICAgIGxldCBnb1RvID0gdGhpcy5jdXJyZW50ICsgMTtcbiAgICAgIGlmIChnb1RvID49IHRoaXMubG9nLmxlbmd0aCkge1xuICAgICAgICBnb1RvID0gdGhpcy5sb2cubGVuZ3RoIC0gMTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY3VycmVudCA9IGdvVG87XG4gICAgICB2dWVCaW5kKGFwcC5sb2dbZ29Ub10pO1xuICAgIH0sXG4gICAgcHJldmlvdXMoKSB7XG4gICAgICBsZXQgZ29UbyA9IHRoaXMuY3VycmVudCAtIDE7XG4gICAgICBpZiAoZ29UbyA8IDApIHtcbiAgICAgICAgZ29UbyA9IDA7XG4gICAgICB9XG4gICAgICB0aGlzLmN1cnJlbnQgPSBnb1RvO1xuICAgICAgdnVlQmluZChhcHAubG9nW2dvVG9dKTtcbiAgICB9LFxuICAgIG9uRGVzY3JpcHRpb246IGZ1bmN0aW9uKHBheWxvYWQsIG9wdGlvbiA9IHVuZGVmaW5lZCkge1xuICAgICAgaWYgKG9wdGlvbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIG9wdGlvbiA9IFwiYWxseVwiO1xuICAgICAgfVxuXG4gICAgICAvL1NvdW5kXG4gICAgICAvLyB0aGlzLiRyZWZzLnNvdW5kQ2xpY2sucGxheSgpO1xuXG4gICAgICAvL0RlZmluZVxuICAgICAgbGV0IG93bmVyID0gdGhpcy5zb3VyY2Vbb3B0aW9uXVtwYXlsb2FkLmhlcm9JbmRleF07XG4gICAgICBsZXQgc2tpbGxJbmRleCA9IG93bmVyLnNraWxsLmZpbmRJbmRleCh4ID0+IHguaWQgPT09IHBheWxvYWQuc2tpbGxJZCk7XG4gICAgICBsZXQgY29uZmlnID0ge1xuICAgICAgICBuYW1lSWQ6IHBheWxvYWQubmFtZUlkLFxuICAgICAgICBza2lsbDogc2tpbGxJbmRleCxcbiAgICAgICAgc2tpbGxJZDogcGF5bG9hZC5za2lsbElkLFxuICAgICAgICBoZXJvSW5kZXg6IHBheWxvYWQuaGVyb0luZGV4LFxuICAgICAgICBvcHRpb246IG9wdGlvblxuICAgICAgfTtcbiAgICAgIGxldCBza2lsbCA9IG93bmVyLnNraWxsW2NvbmZpZy5za2lsbF07XG5cbiAgICAgIC8vTWFwIERlc2NyaXB0aW9uXG4gICAgICBsZXQgbWFwID0ge1xuICAgICAgICBuYW1lOiBza2lsbC5uYW1lLFxuICAgICAgICBlbmVyZ3k6IHtcbiAgICAgICAgICBhOiBza2lsbC5lbmVyZ3kuYSxcbiAgICAgICAgICBpOiBza2lsbC5lbmVyZ3kuaSxcbiAgICAgICAgICBzOiBza2lsbC5lbmVyZ3kucyxcbiAgICAgICAgICB3OiBza2lsbC5lbmVyZ3kudyxcbiAgICAgICAgICByOiBza2lsbC5lbmVyZ3kucixcbiAgICAgICAgICB0b3RhbDpcbiAgICAgICAgICAgIHNraWxsLmVuZXJneS5hICtcbiAgICAgICAgICAgIHNraWxsLmVuZXJneS5pICtcbiAgICAgICAgICAgIHNraWxsLmVuZXJneS5zICtcbiAgICAgICAgICAgIHNraWxsLmVuZXJneS53ICtcbiAgICAgICAgICAgIHNraWxsLmVuZXJneS5yXG4gICAgICAgIH0sXG4gICAgICAgIGRlc2NyaXB0aW9uOiBza2lsbC5kZXNjcmlwdGlvbixcbiAgICAgICAgY2xhc3Nlczogc2tpbGwuY2xhc3NlcyxcbiAgICAgICAgY29vbGRvd246IHNraWxsLmNvb2xkb3duXG4gICAgICB9O1xuXG4gICAgICBsZXQgYWx0ID0gc2tpbGwuYWx0ICE9PSBmYWxzZSA/IHNraWxsLmFsdCA6IGZhbHNlO1xuXG4gICAgICAvL0J1ZmZlciBEZXNjcmlwdGlvblxuICAgICAgbGV0IHN0YXRlID0gdGhpcy5zdGF0ZTtcbiAgICAgIHN0YXRlLmRlc2NyaXB0aW9uID0ge1xuICAgICAgICBuYW1lSWQ6IGNvbmZpZy5uYW1lSWQsXG4gICAgICAgIHNraWxsOiBjb25maWcuc2tpbGxJZCxcbiAgICAgICAgaGVyb0luZGV4OiBjb25maWcuaGVyb0luZGV4LFxuICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgYWx0OiBhbHQsXG4gICAgICAgIG9wdGlvbjogb3B0aW9uXG4gICAgICB9O1xuICAgIH0sXG4gICAgb25HZXRJbWFnZTogZnVuY3Rpb24ocGF5bG9hZCwgb3B0aW9uKSB7XG4gICAgICBpZiAob3B0aW9uID09PSBcInBhY2tldFwiKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiaGlcIik7XG4gICAgICAgIGxldCBpbmRleCA9IHRoaXMuc291cmNlLmFsbHkuZmluZEluZGV4KHggPT4geC5uYW1lID09PSBwYXlsb2FkLm9mZmVuc2UpO1xuICAgICAgICBsZXQgbmFtZUlkID0gdGhpcy5zb3VyY2UuYWxseVtpbmRleF0ubmFtZUlkO1xuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgXCIvYXNzZXRzL2NoYXJhY3Rlci9cIiArXG4gICAgICAgICAgbmFtZUlkLnNsaWNlKDAsIC0xKSArXG4gICAgICAgICAgXCIvc2tpbGxcIiArXG4gICAgICAgICAgKHBheWxvYWQuc2tpbGwgKyAxKSArXG4gICAgICAgICAgXCIvYXZhdGFyLmpwZ1wiXG4gICAgICAgICk7XG4gICAgICB9IGVsc2UgaWYgKG9wdGlvbiA9PT0gXCJjaGFyXCIpIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICBcIi9hc3NldHMvY2hhcmFjdGVyL1wiICsgcGF5bG9hZC5uYW1lSWQuc2xpY2UoMCwgLTEpICsgXCIvYXZhdGFyLmpwZ1wiXG4gICAgICAgICk7XG4gICAgICB9IGVsc2UgaWYgKG9wdGlvbiA9PT0gXCJza2lsbFwiKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgXCIvYXNzZXRzL2NoYXJhY3Rlci9cIiArXG4gICAgICAgICAgcGF5bG9hZC5uYW1lSWQuc2xpY2UoMCwgLTEpICtcbiAgICAgICAgICBcIi9za2lsbFwiICtcbiAgICAgICAgICAocGF5bG9hZC5za2lsbCArIDEpICtcbiAgICAgICAgICBcIi9hdmF0YXIuanBnXCJcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAob3B0aW9uID09PSBcInN0YXR1c1wiKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgXCIvYXNzZXRzL2NoYXJhY3Rlci9cIiArXG4gICAgICAgICAgcGF5bG9hZC5uYW1lSWQuc2xpY2UoMCwgLTEpICtcbiAgICAgICAgICBcIi9za2lsbFwiICtcbiAgICAgICAgICBwYXlsb2FkLnNraWxsICtcbiAgICAgICAgICBcIi9hdmF0YXIuanBnXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG9uSFA6IGZ1bmN0aW9uKGhwKSB7XG4gICAgICBpZiAoaHAgPiA3MCkge1xuICAgICAgICByZXR1cm4gXCJsLS1ocC1mdWxsXCI7XG4gICAgICB9IGVsc2UgaWYgKGhwIDw9IDcwICYmIGhwID49IDQwKSB7XG4gICAgICAgIHJldHVybiBcImwtLWhwLW1pZFwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFwibC0taHAtbG93XCI7XG4gICAgICB9XG4gICAgfSxcbiAgICB0YXJnZXRpbmdDdWU6IGZ1bmN0aW9uKHBheWxvYWQsIG5hbWVJZCkge1xuICAgICAgbGV0IG5hbWUgPSBwYXlsb2FkO1xuICAgICAgbGV0IGluZGV4ID0gdGhpcy5wYWNrZXQuZmluZEluZGV4KHggPT4geC5vZmZlbnNlID09PSBwYXlsb2FkKTtcbiAgICAgIGxldCBwYWNrZXQgPSB0aGlzLnBhY2tldFtpbmRleF07XG5cbiAgICAgIGxldCByZXN1bHQgPSB7XG4gICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgIHNraWxsSW5kZXg6IHBhY2tldC5za2lsbCxcbiAgICAgICAgc2tpbGxJZDogcGFja2V0LnNraWxsSWQsXG4gICAgICAgIGhlcm9JbmRleDogcGFja2V0Lmhlcm9JbmRleCxcbiAgICAgICAgdGFyZ2V0OiBwYWNrZXQudGFyZ2V0XG4gICAgICB9O1xuXG4gICAgICBpZiAobmFtZUlkKSB7XG4gICAgICAgIHJlc3VsdC5uYW1lSWQgPSBuYW1lSWQ7XG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xuXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgfVxufSk7XG4iLCJmdW5jdGlvbiB2dWVCaW5kKHBheWxvYWQpIHtcbiAgY29uc29sZS5sb2cocGF5bG9hZCk7XG4gIGxldCBhbGx5ID0gXCJ0ZWFtRXZlblwiO1xuICBsZXQgZW5lbXkgPSBcInRlYW1PZGRcIjtcbiAgbGV0IHR1cm5WYWwgPSBhbGx5ID09PSBcInRlYW1FdmVuXCIgPyAwIDogMTtcbiAgbGV0IG15VHVybiA9IHBheWxvYWQudHVybiAlIDIgPT09IHR1cm5WYWwgPyB0cnVlIDogZmFsc2U7XG5cbiAgLy9UaW1lXG4gIGxldCB0aW1lRGlmZiA9IChEYXRlLm5vdygpIC0gcGF5bG9hZC50aW1lc3RhbXApIC8gMTAwMDtcbiAgbGV0IHRpbWVDYWxjID0gTWF0aC5mbG9vcig0NSAtIHRpbWVEaWZmKTtcbiAgbGV0IHJlbWFpbmluZyA9IDEwMCAqICh0aW1lQ2FsYyAvIDQ1KTtcbiAgY29uc29sZS5sb2cocGF5bG9hZC50aW1lc3RhbXAsIHRpbWVEaWZmLCB0aW1lQ2FsYywgcmVtYWluaW5nKTtcblxuICBsZXQgc3RvcmUgPSB7XG4gICAgZW5lcmd5OiB7XG4gICAgICBhbGx5OiBwYXlsb2FkLmVuZXJneVthbGx5XSxcbiAgICAgIGVuZW15OiBwYXlsb2FkLmVuZXJneVtlbmVteV1cbiAgICB9LFxuICAgIGFsbHk6IHBheWxvYWRbYWxseV0ubWFwKHggPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4ueCxcbiAgICAgICAgc2tpbGw6XG4gICAgICAgICAgYXBwLm1vZGUgPT09IFwiZ2FtZVwiID8geC5za2lsbCA6IHguc2tpbGwuc29ydCgoYSwgYikgPT4gYS5pZCAtIGIuaWQpLFxuICAgICAgICBpbmRpY2F0b3I6IHN0YXR1c1ZpZXcoeC5uYW1lLCB4LnN0YXR1cywgdHVyblZhbClcbiAgICAgIH07XG4gICAgfSksXG4gICAgZW5lbXk6IHBheWxvYWRbZW5lbXldLm1hcCh4ID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLngsXG4gICAgICAgIHNraWxsOiB4LnNraWxsLnNvcnQoKGEsIGIpID0+IGEuaWQgLSBiLmlkKSxcbiAgICAgICAgaW5kaWNhdG9yOiBzdGF0dXNWaWV3KHgubmFtZSwgeC5zdGF0dXMsIHR1cm5WYWwpXG4gICAgICB9O1xuICAgIH0pLFxuICAgIHR1cm46IHBheWxvYWQudHVybixcbiAgICBteVR1cm46IG15VHVybixcbiAgICB0dXJuVmFsOiB0dXJuVmFsLFxuICAgIHJvb206IHBheWxvYWQucm9vbSxcbiAgICBtZXRhOiB7XG4gICAgICBteU5hbWU6IHBheWxvYWQudGVhbVthbGx5XSxcbiAgICAgIHRoZWlyTmFtZTogcGF5bG9hZC50ZWFtW2VuZW15XVxuICAgIH0sXG4gICAgdGltZXN0YW1wOiBwYXlsb2FkLnRpbWVzdGFtcFxuICB9O1xuICBzdG9yZS5lbmVyZ3kuYWxseS5yID1cbiAgICBzdG9yZS5lbmVyZ3kuYWxseS5hICtcbiAgICBzdG9yZS5lbmVyZ3kuYWxseS5pICtcbiAgICBzdG9yZS5lbmVyZ3kuYWxseS5zICtcbiAgICBzdG9yZS5lbmVyZ3kuYWxseS53O1xuXG4gIGFwcC5zb3VyY2UgPSBzdG9yZTtcbiAgYXBwLnBhY2tldCA9IHBheWxvYWQubG9nO1xuICBhcHAuYWN0aW9uLnB1c2gocGF5bG9hZC5sb2cpO1xuICAvLyBhcHAuc3RhdGUuYnV0dG9uID0gYnV0dG9uO1xuICAvLyBhcHAuc3RhdGUud2lubmVyID0gcGF5bG9hZC53aW5uZXI7XG4gIC8vIGFwcC5zdGF0ZS5leGNoYW5nZS5tb2RhbCA9IGZhbHNlO1xufVxuXG5mdW5jdGlvbiBzdGF0dXNWaWV3KG5hbWUsIHBheWxvYWQsIHR1cm5WYWwpIHtcbiAgY29uc29sZS5sb2cobmFtZS5zbGljZSgtMSksIHBheWxvYWQpO1xuICBsZXQgc3RhdHVzID0gXy5jb25jYXQoXG4gICAgcGF5bG9hZC5vbkF0dGFjayxcbiAgICBwYXlsb2FkLm9uUmVjZWl2ZSxcbiAgICBwYXlsb2FkLm9uU3RhdGUsXG4gICAgcGF5bG9hZC5vblNlbGZcbiAgKTtcbiAgY29uc29sZS5sb2coXCJpbnZpc2libGVcIiwgdHVyblZhbCwgbmFtZS5zbGljZSgtMSkpO1xuICAvLyBzdGF0dXMgPSBzdGF0dXMuZmlsdGVyKFxuICAvLyAgIHggPT5cbiAgLy8gICAgIHguaXNJbnZpc2libGUgPT09IGZhbHNlIHx8XG4gIC8vICAgICAoeC5pc0ludmlzaWJsZSAhPT0gZmFsc2UgJiYgTnVtYmVyKHgubmFtZUlkLnNsaWNlKC0xKSkgPT09IHR1cm5WYWwpXG4gIC8vICk7XG4gIGxldCBncm91cEJ5TmFtZUlkID0gXy5ncm91cEJ5KHN0YXR1cywgXCJuYW1lSWRcIik7XG4gIGxldCB2YWx1ZXNCeU5hbWVJZCA9IF8udmFsdWVzKGdyb3VwQnlOYW1lSWQpO1xuICBsZXQgZ3JvdXBCeVNraWxsSW5kZXggPSB2YWx1ZXNCeU5hbWVJZC5tYXAoeCA9PiBfLmdyb3VwQnkoeCwgXCJza2lsbEluZGV4XCIpKTtcbiAgbGV0IHZhbHVlc0J5U2tpbGxJbmRleCA9IF8udmFsdWVzKGdyb3VwQnlTa2lsbEluZGV4KTtcbiAgbGV0IGNvbmNhdFZhbHVlcyA9IFtdO1xuICB2YWx1ZXNCeVNraWxsSW5kZXguZm9yRWFjaCh4ID0+IHtcbiAgICBjb25jYXRWYWx1ZXMgPSBjb25jYXRWYWx1ZXMuY29uY2F0KF8udmFsdWVzKHgpKTtcbiAgfSk7XG4gIGxldCBmaW5hbCA9IGNvbmNhdFZhbHVlcy5tYXAoeCA9PiB7XG4gICAgbGV0IGluZm8gPSB4WzBdO1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiBpbmZvLm5hbWUsXG4gICAgICBuYW1lSWQ6IGluZm8ubmFtZUlkLFxuICAgICAgc2tpbGxJbmRleDogaW5mby5za2lsbEluZGV4LFxuICAgICAgYWN0aXZlOiBpbmZvLmFjdGl2ZSxcbiAgICAgIHZhbDogeFxuICAgIH07XG4gIH0pO1xuICByZXR1cm4gZmluYWw7XG59XG5cbi8vIHZ1ZUJpbmQoYXBwLmxvZ1swXSk7XG4iLCJmdW5jdGlvbiBnZXRQYXJhbWV0ZXJOYW1lKG5hbWUsIHVybCkge1xuICBpZiAoIXVybCkgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csIFwiXFxcXCQmXCIpO1xuICB2YXIgcmVnZXggPSBuZXcgUmVnRXhwKFwiWz8mXVwiICsgbmFtZSArIFwiKD0oW14mI10qKXwmfCN8JClcIiksXG4gICAgcmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcbiAgaWYgKCFyZXN1bHRzKSByZXR1cm4gbnVsbDtcbiAgaWYgKCFyZXN1bHRzWzJdKSByZXR1cm4gXCJcIjtcbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCBcIiBcIikpO1xufVxuXG5sZXQgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoXCIvXCIpO1xubGV0IHJvb20gPSB1cmxbdXJsLmxlbmd0aCAtIDFdO1xuXG5hcHAuJGh0dHAuZ2V0KFwiL3JlcGxheS9oaXN0b3J5L1wiICsgcm9vbSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gXCIyMDBcIikge1xuICAgIGxldCBib2R5ID0gcmVzcG9uc2UuYm9keVswXTtcbiAgICBhcHAubG9nID0gYm9keS5sb2c7XG4gICAgdnVlQmluZChib2R5LmxvZ1swXSk7XG4gIH1cbn0pO1xuIl19
